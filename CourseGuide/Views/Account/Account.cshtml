@if (ViewData["SuccessMessage"] != null)
{
    <div class="alert alert-success" role="alert">
        @ViewData["SuccessMessage"]
    </div>
}
@if (User.Identity.IsAuthenticated)
{


}

@{
    ViewData["Title"] = "Панель администратора";
}
@if (User.Identity.IsAuthenticated)
{
    <h2>@ViewData["Title"]</h2>
    @if (ViewData["SuccessMessage"] != null)
    {
        <div id="successAlert" class=" alert alert-success" role="alert">
            @ViewData["SuccessMessage"]
        </div>


    }

    <div class="tab-container">
        <div class="tabs">
            <button class="tab-link " onclick="openTab(event, 'Tab1')">Профиль</button>
            <button class="tab-link" onclick="openTab(event, 'Tab2')">Другое</button>

        </div>

        <div id="Tab1" class="tab-content">
            <button id="deleteAccountBtn" class="btn btn-danger" onclick="confirmDelete()">Удалить аккаунт</button>
            <div id="edit">
                @* Здесь будет загружено частичное представление *@
            </div>
            <div id="EditPassword">
                @* Здесь будет загружено частичное представление *@
            </div>
        </div>

        <div id="Tab2" class="tab-content">

            <div id="app">
                @* Здесь будет загружено частичное представление *@
            </div>

        </div>

    </div>

}



@section Scripts {
    <script>
        $(document).ready(function () {

            $.get('@Url.Action("ApplicationAll", "Account")', function (data) {
                $('#app').html(data);
            });
            $.get('@Url.Action("EditProf", "Account")', function (data) {
                $('#edit').html(data);
            });

            $.get('@Url.Action("EditPassword", "Account")', function (data) {
                $('#EditPassword').html(data);
            });

            var alertDiv = $('#successAlert');
            if (alertDiv.length > 0 && alertDiv.text().trim() !== '') {
                alertDiv.show();
                setTimeout(function () {
                    alertDiv.fadeOut('slow');
                }, 3000); // Adjust the timeout value (in milliseconds)
            }

        });

        function add() {
            c = !c;
        }
        function openTab(evt, tabName) {
            // Скрыть все вкладки
            let tabContent = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContent.length; i++) {
                tabContent[i].style.display = "none";
            }

            // Снять активный класс со всех кнопок
            let tabLinks = document.getElementsByClassName("tab-link");
            for (let i = 0; i < tabLinks.length; i++) {
                tabLinks[i].className = tabLinks[i].className.replace(" active", "");
            }

            // Показать выбранную вкладку и добавить активный класс к ней
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";

            // Сохранить выбранную вкладку в localStorage
            localStorage.setItem("activeTab", tabName);
        }

        // При загрузке страницы восстановить состояние
        document.addEventListener("DOMContentLoaded", function () {
            const activeTab = localStorage.getItem("activeTab") || "Tab1"; // По умолчанию Tab1
            document.getElementById(activeTab).style.display = "block";
            const tabLinks = document.getElementsByClassName("tab-link");
            for (let i = 0; i < tabLinks.length; i++) {
                if (tabLinks[i].innerText === document.getElementById(activeTab).previousElementSibling.innerText) {
                    tabLinks[i].className += " active";
                }
            }
        });
        function confirmDelete() {
            if (confirm("Вы действительно хотите удалить свой аккаунт? Это действие необратимо.")) {
                $.ajax({
                    url: '@Url.Action("DeleteAccount", "Account")',
                    type: 'GET',
                    success: function (data) {
                        // Handle success response
                        alert('Вы удалили свой аккаунт');
                        location.reload();

                        // Optionally, redirect or refresh the page
                    },
                    error: function (xhr, status, error) {
                        // Handle error response
                        alert('Error deleting account: ' + xhr.responseJSON.errors);
                    }
                })
            }
        }
    </script>
}



